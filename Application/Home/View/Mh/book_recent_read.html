<!DOCTYPE html>
<!-- saved from url=(0046)https://m.efucms.com/book/recent_read.html -->
<html data-dpr="1" style="font-size: 43.1px;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>{$_CFG['site']['name']} - 书架</title>
    <!-- 共用引入资源.开始 -->

    <script src="__PUBLIC__/home/mhjs/stats.js" name="MTAH5" sid="500462993"></script>
    <meta name="viewport" content="designWidth=750,width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 防止加载lib.flexible加载的时候文字由大变小的闪烁 -->
    <style>html,body{font-size:12px;}</style>
    <!-- lib.flexible 移动端相对适应比例 必须在浏览器head类 -->
    <script type="text/javascript">
        !function (a, b) { function c() { var b = f.getBoundingClientRect().width; b / i > 540 && (b = 540 * i); var c = b / 10; f.style.fontSize = c + "px", k.rem = a.rem = c } var d, e = a.document, f = e.documentElement, g = e.querySelector('meta[name="viewport"]'), h = e.querySelector('meta[name="flexible"]'), i = 0, j = 0, k = b.flexible || (b.flexible = {}); if (g) {  var l = g.getAttribute("content").match(/initial\-scale=([\d\.]+)/); l && (j = parseFloat(l[1]), i = parseInt(1 / j)) } else if (h) { var m = h.getAttribute("content"); if (m) { var n = m.match(/initial\-dpr=([\d\.]+)/), o = m.match(/maximum\-dpr=([\d\.]+)/); n && (i = parseFloat(n[1]), j = parseFloat((1 / i).toFixed(2))), o && (i = parseFloat(o[1]), j = parseFloat((1 / i).toFixed(2))) } } if (!i && !j) { var p = (a.navigator.appVersion.match(/android/gi), a.navigator.appVersion.match(/iphone/gi)), q = a.devicePixelRatio; i = p ? q >= 3 && (!i || i >= 3) ? 3 : q >= 2 && (!i || i >= 2) ? 2 : 1 : 1, j = 1 / i } if (f.setAttribute("data-dpr", i), !g) if (g = e.createElement("meta"), g.setAttribute("name", "viewport"), g.setAttribute("content", "initial-scale=" + 1 + ", maximum-scale=" + 1 + ", minimum-scale=" + 1 + ", user-scalable=no"), f.firstElementChild) f.firstElementChild.appendChild(g); else { var r = e.createElement("div"); r.appendChild(g), e.write(r.innerHTML) } a.addEventListener("resize", function () { clearTimeout(d), d = setTimeout(c, 300) }, !1), a.addEventListener("pageshow", function (a) { a.persisted && (clearTimeout(d), d = setTimeout(c, 300)) }, !1), "complete" === e.readyState ? e.body.style.fontSize = 12 * i + "px" : e.addEventListener("DOMContentLoaded", function () { e.body.style.fontSize = 12 * i + "px" }, !1), c(), k.dpr = a.dpr = i, k.refreshRem = c, k.rem2px = function (a) { var b = parseFloat(a) * this.rem; return "string" == typeof a && a.match(/rem$/) && (b += "px"), b }, k.px2rem = function (a) { var b = parseFloat(a) / this.rem; return "string" == typeof a && a.match(/px$/) && (b += "rem"), b } }(window, window.lib || (window.lib = {}));
    </script>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/home/mhcss/style.min.css">
    <script type="text/javascript" src="__PUBLIC__/home/mhjs/fundebug.0.1.7.min.js" apikey="ba3a0e0d938e92b44f279067dffb8d071ee87fc35eb75918b7a900e8581a955d"></script>
    <script type="text/javascript" src="__PUBLIC__/home/mhjs/jquery.js"></script>
    <!-- 共用引入资源.结束 -->
    <script type="text/javascript" src="__PUBLIC__/home/mhjs/saved_resource"></script>
    <script>(function(){new Image().src='//res.efucms.com/wap_v3/images/placeholder-unruly.png?v=20171208';})();</script>
</head>
<body style="font-size: 12px;">
<div class="navbar flt">
    <nav class="tab-box">
        <div class="item">
            <a href="{:U('Mh/book_shelf')}">收藏</a>
        </div>
        <div class="item">
            <a href="{:U('Mh/book_recent_read')}" class="active">历史</a>
        </div>
    </nav>
    <div class="action">
        <a href="javascript:void(0);" class="btn" id="edit_shelf_btn">
            <div id="niubi"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M38.5 18v20a4.5 4.5 0 0 1-4.5 4.5H14A4.5 4.5 0 0 1 9.5 38V18h-3v20a7.51 7.51 0 0 0 7.5 7.5h20a7.51 7.51 0 0 0 7.5-7.5V18zM18.5 6.42a.87.87 0 0 1 .72-.92h9.46a.9.9 0 0 1 .81 1v4H40v-3h-7.5v-.92a3.9 3.9 0 0 0-3.72-4.08h-9.65a3.86 3.86 0 0 0-3.63 4v1H8v3h10.5z" fill="#fff"></path><path fill="#fff" d="M30.5 24h3v13h-3zM23.5 27h3v10h-3zM15.5 24h3v13h-3z"></path></svg></div>
            <div id="bibibi" style="display:none;">取消</div>
        </a>
    </div>
</div>

<div class="bs-box" style="bottom: 1.333rem;margin-bottom: 0px;">
    <div class="column-list" id="shelf-container">
		<volist name="list" id="vo">
			<div class="item">
				<a href="javascript:;" class="link">
					<div class="cover">
						<img class="img-ajax-lazy" src="{$vo.pic}" data-original="{$vo.pic}" style="background: rgb(238, 238, 238); display: block;">
					</div>
					<div class="body">
						<div class="title">{$vo.title}</div>
						<div class="author">{$vo.author}</div>
						<div class="text">第{$vo.episodes}话</div>
					</div>
				</a>
				<div class="action">
					<if condition="$vo['type'] eq 'mh'">
						<a href="{:U('Mh/inforedit',array('mhid'=>$vo['rid'],'ji_no'=>$vo['episodes']))}" class="btn">续看</a>
					<else />
						<a href="{:U('Book/inforedit',array('bid'=>$vo['rid'],'ji_no'=>$vo['episodes']))}" class="btn">续看</a>
					</if>
				</div>
				<div class="cp-box" style="display:none;">
					<input type="checkbox" name="edit_history_books" class="selected-switch" value="{$vo.id}">
					<div class="swtich"></div>
				</div>
			</div>
		</volist>
    </div>
</div>



<div class="tabar flb" id="footer_nav">
    <nav class="nav hls1">
        <div class="item">
            <a href="{:U('Mh/book_shelf')}" class="active">
                <i class="icon-book"></i><div class="title">书架</div>
            </a>
        </div>
        <div class="item">
            <a href="{:U('Book/index')}">
                <i class="icon-home"></i><div class="title">首页</div>
            </a>
        </div>
        <div class="item">
            <a href="{:U('Mh/my')}">
                <i class="icon-user"></i><div class="title">我的</div>
            </a>
        </div>
    </nav>
</div>

<div class="editable-bar" id="d_layer" style="display:none;">
    <div class="row">
        <div class="cp-box">
            <input type="checkbox" name="select_all" class="select_all">
            <div class="text"><i></i>全选</div>
        </div>
        <div class="action">
            <a href="javascript:void(0);" class="btn delete-selected-btn">
                <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M38.5 18v20a4.5 4.5 0 0 1-4.5 4.5H14A4.5 4.5 0 0 1 9.5 38V18h-3v20a7.51 7.51 0 0 0 7.5 7.5h20a7.51 7.51 0 0 0 7.5-7.5V18zM18.5 6.42a.87.87 0 0 1 .72-.92h9.46a.9.9 0 0 1 .81 1v4H40v-3h-7.5v-.92a3.9 3.9 0 0 0-3.72-4.08h-9.65a3.86 3.86 0 0 0-3.63 4v1H8v3h10.5z" fill="#ff730a"></path><path fill="#ff730a" d="M30.5 24h3v13h-3zM23.5 27h3v10h-3zM15.5 24h3v13h-3z"></path></svg>确定删除(<span id="delete_count">0</span>)
            </a>
        </div>
    </div>
</div>

<div class="mask-box delete-selected-confirm" style="display: none;"></div>
<div class="modal confirm-modal delete-selected-confirm" style="display: none;">
    <div class="inner">
        <div class="confirm-box">
            <div class="body">
                <div class="title">共选中<span id="confirm-delete-count">0</span>个作品</div>
                <div class="text">是否删除已选中作品?</div>
            </div>
            <div class="action">
                <a href="javascript:void(0);" class="btn cancel">取消</a>
                <a href="javascript:void(0);" class="btn confirm">确定</a>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var $select_all = $('.select_all'),
        $delete_confirm = $('.delete-selected-confirm'),
        $delete_count = $("#delete_count"),
        all_selected = "#shelf-container .cp-box .selected-switch.selected",
        $all_selected_switch = $("#shelf-container .cp-box .selected-switch"),
        all_size = $all_selected_switch.size();

    function show_shelf_edit(){
        $('#footer_nav,#niubi,.flb').hide();
        $('#bibibi').text('取消');
        if('1'=='1')
        {
            $(".column-list .action").hide();
        }
        $('.editable-bar,#shelf-container .cp-box,#bibibi').show();
        $("#shelf-container").addClass('editable');
        $(this).off('click',show_shelf_edit).on('click',hide_shelf_edit);
        $("#shelf-container .item[data-looking='1']").on('click',looking_stop_tobook);
    }
    function hide_shelf_edit(){
        $('.editable-bar,#shelf-container .cp-box,#bibibi').hide();
        $('#footer_nav,#niubi').show();
        $("#shelf-container").removeClass('editable');
        $delete_count.text("0");
        $select_all.prop('checked',false);
        $all_selected_switch.removeClass('selected').prop('checked',false);
        $(this).off('click',hide_shelf_edit).on('click',show_shelf_edit);
        $("#shelf-container .item[data-looking='1']").off('click',looking_stop_tobook);
    }
    function looking_stop_tobook(event){
        if(document.all){
            window.event.returnValue = false;
        }else{
            event.preventDefault();
        }
    }
    $('#edit_shelf_btn').on('click',show_shelf_edit);
    $all_selected_switch.click(function(){
        $(this).toggleClass('selected');
        $(this).next().toggleClass('check');
        var selected_size = $(all_selected).size();
        $delete_count.text(selected_size);
        if(selected_size==all_size){
            $select_all.prop('checked',true);
        }else{
            $select_all.prop('checked',false);
        }
    });
    $select_all.click(function(){
        if($select_all.prop('checked')){
            $all_selected_switch.addClass('selected').prop('checked',true);
            $delete_count.text($(all_selected).size());
        }else{
            $all_selected_switch.removeClass('selected').prop('checked',false);
            $(".editable .check").toggleClass('check');
            $delete_count.text('0');
        }
    });
    $(".delete-selected-btn").click(function(){
        var all_selected_size = $(all_selected).size();
        if(all_selected_size<=0){
            bh_msg_tips('您没有选中任何记录');
            return false;
        }
        $delete_confirm.find('#confirm-delete-count').text(all_selected_size).end().show();
    });
    $(".delete-selected-confirm .action .cancel").click(function(){
        $delete_confirm.hide();      
        $('.flb').hide();
        if('1'=='1')
        {
            $(".column-list .action").show();
        }
    });
    $(".delete-selected-confirm .action .confirm").click(function(){
        var reads = $("#shelf-container").find('.item').length;
        var cur_ids = $(all_selected).map(function(){return $(this).val()}).get().join(',');
        //得到选中的数据
        if(!cur_ids){
            bh_msg_tips('您没有选中任何记录');
            return false;
        }
        if($delete_confirm.hasClass('posting')){
            bh_msg_tips('请稍候，请求正在发送中');
            return false;
        }
        var url = "{:U('Mh/deleteRead')}";
        var data = {ids:cur_ids};
        $delete_confirm.addClass('posting');
        $.post(url,data,function(res){
            $delete_confirm.hide().removeClass('posting');
            if(res.status){
                $(all_selected).parents('.item').remove();
                $delete_count.text("0");
                $select_all.prop('checked',false);
                $('#bibibi').text('完成');
				bh_msg_tips(res.info);
				setTimeout(function(){
					location.reload();
				},2000);
                
            }else{
                bh_msg_tips(res.info);
            }
        })
    });
</script>
</body>
<include file="include/share2" />
</html>